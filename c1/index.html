<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
        }
        #canvas {
            display: block;
            height: 100vh;
            overflow: hidden;
            position: absolute;
            top: 0;
            z-index: 10;
        }
    </style>
</head>
<body>
    <canvas id="canvas">

    </canvas>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script src="matter.min.js" ></script>
<script>
const timeOuts = [];

function clearTimeOuts() {
    for (let timeOut of timeOuts) {
        clearTimeout(timeOut);
    }
    timeOuts.length = 0;
}

const world = document.querySelector('#canvas');
const { Engine, Render, Runner, World, Bodies } = Matter;

let engine = Engine.create();

const textures = [
    "https://i.ibb.co/z4VSpxG/face-1.png",
    "https://i.ibb.co/cDXgJ6C/face-2.png",
    "https://i.ibb.co/NTPjrhs/face-3.png",
    "https://i.ibb.co/T4rKcVC/face-4.png",
    "https://i.ibb.co/Dw9049M/face-5.png",
    "https://i.ibb.co/gt9BYYQ/face-6.png",
    "https://i.ibb.co/hfys0b2/face-7.png",
    "https://i.ibb.co/zbDfcrh/face-8.png",
    "https://i.ibb.co/6RP73dX/face-9.png",
    "https://i.ibb.co/nns9sKj/face-10.png"
];

function init() {
    let width = $(window).width();
    let height = $(window).height();
    let vmin = Math.min(width, height);

    engine.events = {};
    World.clear(engine.world);
    Engine.clear(engine);
    engine = Engine.create();
    engine.world.gravity.y = 0.5;  // change gravity

    let render = Render.create({
        canvas: world,
        engine: engine,
        options: {
            wireframes: false,
            background: 'transparent',
            width: width,
            height: height
        }
    });

    // static blocks to make container
    World.add(engine.world, [
        // ground
        Bodies.rectangle(width / 2, height + 50, width, 100, {
            isStatic: true,
            render: {
                fillStyle: "green"
            }
        }),
        // left wall
        Bodies.rectangle(-50, height / 2, 100, height, {
            isStatic: true
        }),
        // right wall
        Bodies.rectangle(width + 50, height / 2, 100, height, {
            isStatic: true
        }),
    ]);

    function createBall() {
        const ORIGINAL_SIZE = 60;
        const SIZE = 60;
        const ball = Bodies.circle(Math.round(Math.random() * width), -30, 45, { // spawn height : -30, radius : 45
            angle: Math.PI * (Math.random() * 2 - 1),
            friction: 0.001,  // friction between balls
            frictionAir: 0.01, // changing this also helps control falling speed
            restitution: 0.4, // change bounce
            render: { // appearance of balls
                sprite: {
                    texture: textures[ Math.floor(Math.random() * (textures.length)) ],
                    xScale: SIZE / ORIGINAL_SIZE, // to scale the image on the body
                    yScale: SIZE / ORIGINAL_SIZE
                }
            }
        });

        let timeOutId = setTimeout(() => { // check 6 seconds after spawn, if above the linit then clear canvas
            if (ball.position.y < -40) { // -30 is spawn height
                World.clear(engine.world, true); // true parameter keepStatic, keep the static container when clearing
                clearTimeOuts();
            }
            timeOuts.shift();
        }, 6000); // change timeout according to gravity (give balls time to drop below -20)
        timeOuts.push(timeOutId);
        return ball;
    }

    Engine.run(engine);

    Render.run(render);
    const handleClick = () => {
        const ball2 = createBall();
        World.add(engine.world, [ball2]);
    };
    setInterval(handleClick, 200); // control spawn rate
}

init();

$(window).resize(function () {
    clearTimeOuts();
    init();
});
</script>
</html>